<!DOCTYPE html><html lang=en><head>
	<meta content="text/html; charset=utf-8" http-equiv=Content-Type>
	<title>Proposal for RespImg Syntax</title>
	<link href=../common/default.css rel=stylesheet type=text/css>
	<link href=http://dev.w3.org/csslogo.ico rel="shortcut icon" type=image/x-icon>
	<meta content=summary name=twitter:card>
	<meta content="Proposal for RespImg Syntax" name=twitter:title>
	<meta content='This document describes a proposed syntax for "responsive images", which allows a user agent to choose an appropriate version of an image from several candidates.' name=twitter:description>
	<meta content=@tabatkins name=twitter:creator>
	<script src=../common/prism.js></script>
	<script>
	window.findAll = window.findAll || function(sel){ return [].slice.call(document.querySelectorAll(sel)) };
	Function.prototype.aritize = function(numArgs) {
		var fn = this;
		return function() {
			var args = [].slice.call(arguments, 0, numArgs);
			return fn.apply(this, args);
		}
	};
	window.addEventListener('load', function() {
		findAll(".example pre:not(.literal), pre[class*='lang-'], pre[class*='language-']")
			.map(Prism.highlightElement.aritize(1));
	}, false);
	</script>
	<link href=../common/prism.css rel=stylesheet type=text/css>
	<style>
body { 
	background: white url(http://www.w3.org/StyleSheets/TR/logo-unofficial.png) top left no-repeat fixed; 
	font-family: sans-serif;
	color: black;
}

:link { color: #00C; }
:visited { color: #609; }
a[href]:active { color: #C00; }
a[href]:hover { background: #ffa; }
a img { border: none; }

h1, h2, h3 { color: #005A9C; }
h1 { font: 170% sans-serif }
h2 { font: 140% sans-serif }
h3 { font: 120% sans-serif }
h4 { font: bold 100% sans-serif }
h5 { font: italic 100% sans-serif }
h6 { font: small-caps 100% sans-serif }

div.head { margin-bottom: 1em }
div.head h1 { margin-top: 2em; clear: both }
div.head table { margin-left: 2em; margin-top: 2em }

p.copyright { font-size: small }
p.copyright small { font-size: small }

ul.toc, ol.toc {
	list-style: none;
}

pre { margin-left: 2em }

dt { font-weight: bold }

[data-autolink="property"]::before, [data-autolink="maybe"]::before {content: "\2018";}
[data-autolink="property"]::after, [data-autolink="maybe"]::after {content: "\2019";}

.example .language-css, .example .language-markup {
	background: transparent;
}
	</style>
</head>
<body class="h-entry lang-css">
<div class=head>
	<p data-fill-with=logo></p>
	<h1 class="p-name no-ref" id=title>Proposal for RespImg Syntax</h1>
	<h2 class="no-num no-toc no-ref heading settled heading" id=subtitle><span class=content>Unofficial Proposal Draft,
		<span class=dt-updated><span class=value-title title=20131017>17 October 2013</span></span></span></h2>
	<div data-fill-with=spec-metadata><dl><dt>This version:<dd><a class=u-url href=http://www.w3.org/TR/2013/UD-respimg-1-20131017/>http://www.w3.org/TR/2013/UD-respimg-1-20131017/</a><dt>Editor’s Draft:<dd><a href=http://tabatkins.github.io/specs/respimg/Overview.html>http://tabatkins.github.io/specs/respimg/Overview.html</a>
    <dt>Feedback:</dt>
        <dd><a href="mailto:public-respimg@w3.org?subject=%5Brespimg%5D%20feedback">public-respimg@w3.org</a>
            with subject line
            “<kbd>[respimg] <var>… message topic …</var></kbd>”(<a href=http://lists.w3.org/Archives/Public/public-respimg/ rel=discussion>archives</a>)<dt>Test Suite:<dd>None Yet<dt>Editors:
<dd class="p-author h-card vcard"><a class="p-name fn u-url url" href=http://xanthir.com/contact/>Tab Atkins</a> (<span class="p-org org">Google</span>)</dl></div>
	<div data-fill-with=warning></div>
	<p class=copyright data-fill-with=copyright><a href=http://creativecommons.org/publicdomain/zero/1.0/ rel=license><img alt=CC0 src=http://i.creativecommons.org/p/zero/1.0/80x15.png></a>
To the extent possible under law, the editors have waived all copyright 
and related or neighboring rights to this work. 
In addition, as of 17 October 2013, 
the editors have made this specification available under the
<a href=http://www.openwebfoundation.org/legal/the-owf-1-0-agreements/owfa-1-0 rel=license>Open Web Foundation Agreement Version 1.0</a>,
which is available at http://www.openwebfoundation.org/legal/the-owf-1-0-agreements/owfa-1-0.
Parts of this work may be from an existing specification document.  If so, those parts are instead covered by the license of the existing specification document.</p>
	<hr title="Separator for header">
</div>

<h2 class="no-num no-toc no-ref heading settled heading" id=abstract><span class=content>Abstract</span></h2>
<p class=p-summary data-fill-with=abstract>This document describes a proposed syntax for "responsive images", which allows a user agent to choose an appropriate version of an image from several candidates.</p>

<h2 class="no-num no-toc no-ref heading settled heading" id=status><span class=content>Status of this document</span></h2>
<div data-fill-with=status><p>
	This is an unofficial draft.
	It is provided for discussion only and may change at any moment.
	Its publication here does not imply endorsement of its contents by W3C. 
	Don’t cite this document other than as work in progress.</div>
<div data-fill-with=at-risk></div>

<h2 class="no-num no-toc no-ref heading settled heading" id=contents><span class=content>Table of contents</span></h2>
<div data-fill-with=table-of-contents><ul class=toc><li><a href=#intro><span class=secno>1</span>
Introduction</a><li><a href=#problem><span class=secno>2</span>
The Problem Statement</a><li><a href=#syntax><span class=secno>3</span>
The Syntax Proposal</a><ul class=toc><li><a href=#media-queries><span class=secno>3.1</span>
Art Direction</a><li><a href=#resolution><span class=secno>3.2</span>
Resolution</a><li><a href=#viewport><span class=secno>3.3</span>
Variable-Sized Images</a></ul><li><a href=#model><span class=secno>4</span>
Processing Model</a><ul class=toc><li><a href=#obtain-candidates><span class=secno>4.1</span>
Obtaining the Image Candidates</a></ul><li><a href=#references><span class=secno></span>
References</a><ul class=toc><li><a href=#normative><span class=secno></span>
Normative References</a><li><a href=#informative><span class=secno></span>
Informative References</a></ul><li><a href=#index><span class=secno></span>
Index</a><li><a href=#property-index><span class=secno></span>
Property index</a><li><a href=#issues-index><span class=secno></span>Issues Index</a></ul></div>



<h2 class="heading settled heading" data-level=1 id=intro><span class=secno>1 </span><span class=content>
Introduction</span><a class=self-link href=#intro></a></h2>

<p>	The Responsive Images community has been trying for some time to come up with a syntax for specifying responsive images
	that satisfies multiple use-cases.
	Their most popular attempt so far,
	the <code>&lt;picture&gt;</code> element,
	only hits 2 of the 3 major use-cases,
	and has certain aspects that implementors seem to be rather unhappy with.

<p>	This document defines a new attempt at the problem,
	sketched out in collaboration between me and John Mellor,
	which solves all three of the major use-cases,
	while avoiding implementor concerns,
	and hopefully being very easily usable.

<h2 class="heading settled heading" data-level=2 id=problem><span class=secno>2 </span><span class=content>
The Problem Statement</span><a class=self-link href=#problem></a></h2>

<p>	To make things somewhat clearer,
	I’ll outline here the three use-cases that the responsive images community has been attempting to address.

	<ol>
		<li>
			<dfn data-dfn-type=dfn data-noexport="" id=resolution0 title=resolution>Resolution-based discrimination<a class=self-link href=#resolution0></a></dfn> - providing the same image in multiple resolutions,
			so that high-res devices can get the prettiest picture,
			while low-res or low-bandwidth devices can avoid wasting time and bandwidth with overly-large files.

		<li>
			<dfn data-dfn-type=dfn data-noexport="" id=art-direction title=art-direction>Art-direction discrimination<a class=self-link href=#art-direction></a></dfn> - as the screen size changes,
			so might your page’s design.
			A large, detailed image might be appropriate for the desktop design,
			but just scaling it down for a small phone’s screen results in a tiny, cluttered image.
			Instead, you may want to provide alternate images,
			cropped differently to better fit the small screen
			and still show the most important parts of the image at an appropriate size.

		<li>
			<dfn data-dfn-type=dfn data-noexport="" id=viewport0 title=viewport>Variable-size resolution discrimination<a class=self-link href=#viewport0></a></dfn> -
			sometimes the image you’re serving is variable-sized:
			either based on the size of the viewport
			or just different sizes at different breakpoints.
			A combination of the solutions to the above two problems <em>can</em> address this,
			but very verbosely -
			you have to do math to figure out breakpoints
			(not intrinsically related to your site’s breakpoints)
			and repeat urls multiple times.
			For example, a 1000px wide image might be appropriate as a 1x image
			when used to fill the background of the page on a desktop screen,
			but it’s far too large to use for the same purpose on a 320px wide screen.
			On a screen that small, it’s more like a 2x or 3x image.
	</ol>

<p>	In addition, there’s a strong requirement that the solution be friendly to the browser’s preloader,
	which scans the document for urls to start downloading quickly,
	as the connection delay is a huge factor in the feeling of "slow" sites on mobile devices,
	and so starting the connection as early as possible is a big win in perceived performance.
	This limits what kind of information you can rely on,
	as the preloader only has access to a small amount of data from the page.

<h2 class="heading settled heading" data-level=3 id=syntax><span class=secno>3 </span><span class=content>
The Syntax Proposal</span><a class=self-link href=#syntax></a></h2>

<p>	Add a set of attributes to <code>&lt;img&gt;</code>,
	named <code>src-1</code>, <code>src-2</code>, etc.
	Collectively,
	these are the <dfn data-dfn-type=dfn data-export="" id=src-n--src-n-attribute title="src-N | src-N attribute">src-N attributes<a class=self-link href=#src-n--src-n-attribute></a></dfn>

<p>	When loading an image,
	these attributes are consulted first,
	in numerical order.
	If none of them are valid or match,
	then the plain <code>src</code> attribute is used to load the image.

<p class=note>	Note: It’s possible to integrate <code>srcset</code> into this if necessary,
	but it would be nice to avoid doing that.
	This completely replaces the <code>srcset</code> funtionality.

<p>	The grammar for the attributes is:

	<pre>  <dfn class=css-code data-dfn-type=type data-export="" id=typedef-src-n-attribute>&lt;src-n-attribute&gt;<a class=self-link href=#typedef-src-n-attribute></a></dfn> = <a class="production css-code" data-link-type=type title="<media-query>">&lt;media-query&gt;</a>? [ <a class="production css-code" data-link-type=type href=#typedef-x-based-urls title="<x-based-urls>">&lt;x-based-urls&gt;</a> | <a class="production css-code" data-link-type=type href=#typedef-viewport-urls title="<viewport-urls>">&lt;viewport-urls&gt;</a> ]
  <dfn class=css-code data-dfn-type=type data-export="" id=typedef-x-based-urls>&lt;x-based-urls&gt;<a class=self-link href=#typedef-x-based-urls></a></dfn> = [ <a class="production css-code" data-link-type=type href=http://dev.w3.org/csswg/css-values-3/#url-value title="<url>">&lt;url&gt;</a> <a class="production css-code" data-link-type=type href=http://dev.w3.org/csswg/css-values-3/#resolution-value title="<resolution>">&lt;resolution&gt;</a>? ]#

  <dfn class=css-code data-dfn-type=type data-export="" id=typedef-viewport-urls>&lt;viewport-urls&gt;<a class=self-link href=#typedef-viewport-urls></a></dfn> = <a class="production css-code" data-link-type=type href=#typedef-size-viewport-list title="<size-viewport-list>">&lt;size-viewport-list&gt;</a> ; <a class="production css-code" data-link-type=type href=#typedef-size-based-urls title="<size-based-urls>">&lt;size-based-urls&gt;</a>
  <dfn class=css-code data-dfn-type=type data-export="" id=typedef-size-viewport-list>&lt;size-viewport-list&gt;<a class=self-link href=#typedef-size-viewport-list></a></dfn> = <a class="production css-code" data-link-type=type href=#typedef-image-size title="<image-size>">&lt;image-size&gt;</a> [ ( <a class="production css-code" data-link-type=type href=#typedef-viewport-size title="<viewport-size>">&lt;viewport-size&gt;</a> ) <a class="production css-code" data-link-type=type href=#typedef-image-size title="<image-size>">&lt;image-size&gt;</a> ]*
  <dfn class=css-code data-dfn-type=type data-export="" id=typedef-image-size>&lt;image-size&gt;<a class=self-link href=#typedef-image-size></a></dfn> = <a class="production css-code" data-link-type=type href=http://dev.w3.org/csswg/css-values-3/#length-value title="<length>">&lt;length&gt;</a> | <a class="production css-code" data-link-type=type href=http://dev.w3.org/csswg/css-values-3/#percentage-value title="<percentage>">&lt;percentage&gt;</a>
  <dfn class=css-code data-dfn-type=type data-export="" id=typedef-viewport-size>&lt;viewport-size&gt;<a class=self-link href=#typedef-viewport-size></a></dfn> = <a class="production css-code" data-link-type=type href=http://dev.w3.org/csswg/css-values-3/#length-value title="<length>">&lt;length&gt;</a>
  <dfn class=css-code data-dfn-type=type data-export="" id=typedef-size-based-urls>&lt;size-based-urls&gt;<a class=self-link href=#typedef-size-based-urls></a></dfn> = [ <a class="production css-code" data-link-type=type href=http://dev.w3.org/csswg/css-values-3/#url-value title="<url>">&lt;url&gt;</a> <a class="production css-code" data-link-type=type href=http://dev.w3.org/csswg/css-syntax-3/#typedef-integer title="<integer>">&lt;integer&gt;</a> ]#
</pre>
<p>	The above grammar must be interpreted per the grammar definition in <a data-biblio-type=normative data-link-type=biblio href=#css3val title=css3val>[CSS3VAL]</a>.
	For the purposes of the above grammar,
	the <a class="production css-code" data-link-type=type href=http://dev.w3.org/csswg/css-values-3/#url-value title="<url>">&lt;url&gt;</a> production is simply any sequence of non-<a data-link-spec=css-syntax data-link-type=dfn href=http://dev.w3.org/csswg/css-syntax-3/#whitespace title=whitespace>whitespace</a> characters
	that does not end in a comma or semicolon.
	All other terminal productions are defined as per CSS.

<p>	The terms and use of this grammar are explained further in the following sections.

<p class=note>	Note: Any explanations of how the attributes and their values are processed that appear in this section are <em>non-normative</em>.
	The normative definition of the processing model is in the "Processing" section.

<h3 class="heading settled heading" data-level=3.1 id=media-queries><span class=secno>3.1 </span><span class=content>
Art Direction</span><a class=self-link href=#media-queries></a></h3>

<p>	To solve the basic <a data-link-type=dfn href=#art-direction title=art-direction>art-direction</a> use-case,
	the <a data-link-type=dfn href=#src-n--src-n-attribute title="src-n attributes">src-N attributes</a> allow a media query to be provided at the beginning of their value.

	<p class=issue id=issue-06cc56d0><a class=self-link href=#issue-06cc56d0></a>
		I want just the second clause of the <code>media_query</code> grammar in Media Queries 4,
		where you have "(foo:bar) and (baz:qux)" and that’s it.
		I should go fix the grammar section there to expose this more cleanly.

<p>	Each valid <a data-link-type=dfn href=#src-n--src-n-attribute title="src-n attribute">src-N attribute</a> is checked in numerical order,
	and the first one to have a matching media query
	(or no media query at all)
	is chosen as the source of candidate urls for this <code>&lt;img&gt;</code>.

	<div class=example>
		The following three crops of the same image can be used on various screen sizes,
		where different designs call for different image shapes and sizes:

		<figure>
			<img alt="Three crops of the same image. The first shows President Obama talking to a soldier in hospital scrubs. The second is zoomed out, showing more soldiers standing around them.  The third is zoomed out even further, showing even more soldiers and more of the hospital room." src=images/difimages.jpg>
		</figure>

<p>		These could be referenced like:

		<pre class=lang-markup>  &lt;img src-1="(max-width: 400px) pic-small.jpg"
       src-2="(max-width: 1000px) pic-medium.jpg"
       src="pic-large.jpg"
       alt="Obama talking to a soldier in hospital scrubs."&gt;
</pre>
<p class=note>		Note: Putting the final url into a <code>src</code> attribute like that isn’t required;
		in fact, if using any of the more advanced pieces of this feature,
		like multiple resolutions,
		it would <em>have</em> to be in a <a data-link-type=dfn href=#src-n--src-n-attribute title="src-n attribute">src-N attribute</a>
		(using <code>src-3</code> would be most appropriate here).
		Still, having a final fallback in <code>src</code> is a good idea,
		as it means that down-level browsers will still be able to correctly download the image.
	</div>

<p class=note>	Note: This feature is intended to be used with <em>distinct</em> images.
	Look at the "Viewport" subsection about choosing among multiple copies of the <em>same</em> image
	based on viewport size.

<h3 class="heading settled heading" data-level=3.2 id=resolution><span class=secno>3.2 </span><span class=content>
Resolution</span><a class=self-link href=#resolution></a></h3>

<p>	To solve the <a data-link-type=dfn href=#resolution0 title=resolution>resolution</a> use-case,
	the <a data-link-type=dfn href=#src-n--src-n-attribute title="src-n attributes">src-N attributes</a> allow multiple urls to be provided,
	each with an indicator of their resolution
	(the ratio of image pixels to CSS pixels).

<p>	Instead of a single url,
	simply provide a comma-separated list of urls/resolution pairs,
	where each pair is a url, followed by whitespace, followed by a CSS <a class="production css-code" data-link-type=type href=http://dev.w3.org/csswg/css-values-3/#resolution-value title="<resolution>">&lt;resolution&gt;</a> value.
	A url provided without a <a class="production css-code" data-link-type=type href=http://dev.w3.org/csswg/css-values-3/#resolution-value title="<resolution>">&lt;resolution&gt;</a> is assumed to be at <span class=css data-link-type=maybe title=1x>1x</span> resolution.

	<p class=issue id=issue-8c2c662b><a class=self-link href=#issue-8c2c662b></a>
		Assume that I’ve already edited Images 4 appropriately so that <span class=css data-link-type=maybe title=x>x</span> is a valid resolution unit,
		equivalent to <span class=css data-link-type=maybe title=dppx>dppx</span>.

	<div class=example>
		For example, the following code provides the same image at three different resolutions:
		one at "normal size",
		where each image pixel maps to one CSS pixel;
		one "high-res",
		which is double the size but meant to be displayed with two image pixels for every one CSS pixel;
		and one "low-res",
		which is half the size,
		intended for low-bandwidth situations.

		<pre class=lang-markup>  &lt;img src-1="pic.png, picHigh.png 2x, picLow.png .5x"&gt;
</pre>	</div>

<p>	The choice of which image to load is left to the user agent,
	based on its knowledge of the screen’s pixel density,
	the device’s bandwidth,
	and whatever other factors it deems relevant to the decision.

<p>	The intrinsic size of the chosen image is equal to the actual number of image pixels in each dimension,
	divided by the chosen resolution multiplier,
	in CSS px units.
	For example, if "pic1.png 2x" is chosen, and is 100 pixels wide,
	its intrinsic size is <span class=css data-link-type=maybe title=50px>50px</span>.

<h3 class="heading settled heading" data-level=3.3 id=viewport><span class=secno>3.3 </span><span class=content>
Variable-Sized Images</span><a class=self-link href=#viewport></a></h3>

<p>	A final, more complex consideration is that an image may not have a single given size:
	it may be sized as a fraction of the viewport
	(for example, a page-filling image),
	or you may simply deliver the same image at different sizes in each of your site’s breakpoints.
	When this occurs, a single image file may serve as various densities,
	depending on the size it’s meant to be rendered at.

<p>	For example,
	an image intended to be screen-filling may be <span class=css data-link-type=maybe title=1000px>1000px</span> wide on a desktop screen,
	but only <span class=css data-link-type=maybe title=300px>300px</span> wide on a phone screen.
	As such, the version of the image that’s 1000 image pixels wide is a <span class=css data-link-type=maybe title=1x>1x</span> version on desktop,
	but a <span class=css data-link-type=maybe title=3.33x>3.33x</span> version or so on the phone.

<p>	This reuse of image assets can be accomplished using just the media queries and resolution specifiers defined in the previous section,
	but only with a lot of duplication of urls,
	which makes writing the image frustrating
	and maintenance error-prone.
	Instead, there is a <strong>shortcut</strong> grammar
	which expresses the image urls in a slightly different way,
	handling this case without any duplication.

<p>	Rather than a list of urls and resolution specifiers,
	you first specify a list of alternating image sizes and viewport breakpoints.
	You then specify your list of urls paired with the images' <em>actual sizes</em>,
	rather than their resolution.
	The user agent uses the target image size to transform these into effective resolution factors,
	and then chooses which one to download as normal.

<p>	The intrinsic width of the image is equal to the image size chosen from the provided list.
	If the image has an intrinsic ratio, the intrinsic height of the image is its intrinsic width multiplied by the ratio.
	Otherwise, it has no intrinsic height.

	<div class=example>
		For a simple example,
		assume that a particular image will be approximately 100% of the viewport width at all sizes,
		such as a header image.
		It is extremely simple to write an attribute value that will cause the browser to choose the correct image
		across a wide variety of window sizes:

		<pre class=lang-markup>  &lt;img src-1="100%; pic1.png 160, pic2.png 320, pic3.png 640,
                   pic4.png 1280, pic5.png 2560"&gt;
</pre>
<p>		With this one declaration,
		a high-res phone 320px wide can correctly choose to download <code>pic3.png</code> (an effective 2x resolution),
		while a large desktop screen with 96dpi will correctly choose to download <code>pic4.png</code> (approximately a 1x resolution).
		Anything at higher, lower, or in-between sizes and resolutions will also be appropriately catered for,
		without the author having to explicitly figure out reasonable breakpoints
		and categorize each image appropriately for each.
	</div>

	<div class=example>
		For example, say your site had three basic layouts,
		at breakpoints of <span class=css data-link-type=maybe title=30em>30em</span> and <span class=css data-link-type=maybe title=70em>70em</span>.
		In the first layout, your image has a size of 100px;
		in the second layout, it has a size of 400px;
		in the third layout, it’s approximately half the viewport wide.
		The following diagram illustrates this:

		<figure>
			<svg height=200 width=800>
				<style>
				text { font-family: sans-serif; }
				</style>
				<g id=line transform="translate(0, 60)">
					<text style="font-size: 30px" x=0 y=10>0</text>
					<line stroke=black stroke-width=4 x1=30 x2=700 y1=0 y2=0></line>
					<g transform="translate(250, 0)">
						<line stroke=black stroke-width=4 x1=0 x2=0 y1=-10 y2=10></line>
						<text style="font-size: 20px" text-anchor=middle x=0 y=-20>30em</text>
						<text style="font-size: 20px" text-anchor=middle x=0 y=-45>Breakpoint 1</text>
					</g>
					<g transform="translate(500, 0)">
						<line stroke=black stroke-width=4 x1=0 x2=0 y1=-10 y2=10></line>
						<text style="font-size: 20px" text-anchor=middle x=0 y=-20>70em</text>
						<text style="font-size: 20px" text-anchor=middle x=0 y=-45>Breakpoint 2</text>
					</g>
					<circle cx=715 cy=0 r=3></circle>
					<circle cx=730 cy=0 r=3></circle>
					<circle cx=745 cy=0 r=3></circle>
					<text style="font-size: 30px" x=770 y=10>∞</text>
				</g>
				<g transform="translate(90, 80)">
					<rect fill=#ddd height=80 stroke=gray stroke-width=2 width=100></rect>
					<rect fill=blue height=30 width=30 x=65 y=25></rect>
					<circle cx=40 cy=20 fill=green r=15></circle>
					<polygon fill=red points="5 40, 40 75, 5 75"></polygon>
					<text style="font-size: 16px" text-anchor=middle x=50 y=100>100px wide</text>
				</g>
				<g transform="translate(325, 80)">
					<rect fill=#ddd height=80 stroke=gray stroke-width=2 width=100></rect>
					<rect fill=blue height=30 width=30 x=65 y=25></rect>
					<circle cx=40 cy=20 fill=green r=15></circle>
					<polygon fill=red points="5 40, 40 75, 5 75"></polygon>
					<text style="font-size: 16px" text-anchor=middle x=50 y=100>400px wide</text>
				</g>
				<g transform="translate(575, 80)">
					<rect fill=#ddd height=80 stroke=gray stroke-width=2 width=100></rect>
					<rect fill=blue height=30 width=30 x=65 y=25></rect>
					<circle cx=40 cy=20 fill=green r=15></circle>
					<polygon fill=red points="5 40, 40 75, 5 75"></polygon>
					<text style="font-size: 16px" text-anchor=middle x=50 y=100>50% of the viewport width wide</text>
				</g>
			</svg>
			<figcaption>Illustration of three image sizes at different layouts, separated by breakpoints.</figcaption>
		</figure>

<p>		Assuming that the same image is supposed to be used at all of these layouts
		(that is, you aren’t doing <a data-link-type=dfn href=#art-direction title=art-direction>art-direction</a> cropping to optimize the display of the image for a given size),
		then all of these cases can be addressed by a handful of images at various sizes,
		and the following code:

		<pre class=lang-markup>  &lt;img src-1="100px (30em) 400px (70em) 50%;
             pic50.png 50, pic100.png 100, pic200.png 200,
             pic400.png 400, pic800.png 800, pic1600.png 1600,
             pic3200.png 3200"&gt;
</pre>
<p>		These seven images cover a wide range of possibilities:

<p>		<ul>
			<li>
				At the low end,
				when the image will be 100px wide,
				the first few sources have an effective resolution of .5x, 1x, and 2x.
				The rest of the sources are probably far too high-resolution to matter.

			<li>
				In the medium case,
				when the image will be 400px wide,
				the first few images are too low-resolution to likely matter,
				but the "pic200.png" image is a .5x image,
				and several past that are all reasonable 1x, 2x, or 4x sized images.

			<li>
				In the final layout,
				where the likely minimum image size is 560px,
				but it may be much larger on huge screens,
				any of the images from the middle to the end may be appropriate.
		</ul>

<p>		Doing the same thing using just media queries and resolutions is much more verbose:

		<pre class=lang-markup>  &lt;img src-1="(max-width: 30em) pic50.png .5x, pic100.png 1x, pic200.png 2x, pic400.png 4x"
       src-2="(max-width: 70em) pic200.png .5x, pic400.png 1x, pic800.png 2x, pic1600.png 4x"
       src-3="pic400.png .5x, pic800.png 1x, pic1600.png 2x, pic3200.png 4x"&gt;
</pre>
<p>		And it’s not even as correct - in the final case, the above code assumes an 800px wide image for brevity;
		if the actual image is closer to the minimum or much higher than 800,
		those ratios will be wrong
		and might cause the browser to download the wrong image.
	</div>

<h2 class="heading settled heading" data-level=4 id=model><span class=secno>4 </span><span class=content>
Processing Model</span><a class=self-link href=#model></a></h2>

<p>	This section describes the processing model for images.

<p>	As each <code>&lt;img&gt;</code> element is encountered on the page,
	run the following steps for it:

	<ol>
		<li>
			Let <var>candidates</var> be the result of <a data-link-type=dfn href=#obtain-the-image-candidatesobtaining-the-image-candidates title="obtaining the image candidates">obtaining the image candidates</a> from the element.

		<li>
			If <var>candidates</var> is empty,
			abort this algorithm.
			<p class=issue id=issue-fc5e642a><a class=self-link href=#issue-fc5e642a></a>
				Is this the right place to say "fire a load error" or whatever?

		<li>
			<p class=issue id=issue-e3021f25><a class=self-link href=#issue-e3021f25></a>
				Update the image data, choose the right candidate, etc, etc, hook up to the right terms in HTML.
				The actual choice is UA-specific.
	</ol>

<h3 class="heading settled heading" data-level=4.1 id=obtain-candidates><span class=secno>4.1 </span><span class=content>
Obtaining the Image Candidates</span><a class=self-link href=#obtain-candidates></a></h3>

<p>	This section describes how to <dfn data-dfn-type=dfn data-noexport="" id=obtain-the-image-candidatesobtaining-the-image-candidates title="obtain the image candidates|obtaining the image candidates">obtain the image candidates<a class=self-link href=#obtain-the-image-candidatesobtaining-the-image-candidates></a></dfn>
	from an HTML <code>&lt;img&gt;</code> element.

<p>	The input to this algorithm is an HTML <code>&lt;img&gt;</code> element.
	The output of this algorithm is a (possibly empty) list of <dfn data-dfn-type=dfn data-noexport="" id=image-candidate title="image candidate">image candidates<a class=self-link href=#image-candidate></a></dfn>,
	where each candidate is a pair composed of a url and a resolution.

	<ol>
		<li>
			Let <var>candidate attributes</var> be the list of attributes on the element who satisfy the following conditions:

<p>			<ul>
				<li>The attribute name is at least 5 characters long.

				<li>The first four characters of the attribute name are an <a data-link-spec=css-syntax data-link-type=dfn href=http://dev.w3.org/csswg/css-syntax-3/#ascii-case-insensitive title="ascii case-insensitive">ASCII case-insensitive</a> match for "src-".

				<li>The fifth character of the attribute name is a non-zero <a data-link-spec=css-syntax data-link-type=dfn href=http://dev.w3.org/csswg/css-syntax-3/#digit title=digit>digit</a> (1-9).

				<li>The remaining characters of the attribute name are <a data-link-spec=css-syntax data-link-type=dfn href=http://dev.w3.org/csswg/css-syntax-3/#digit title=digits>digits</a> (0-9).

				<li>The attribute value matches the <a class="production css-code" data-link-type=type href=#typedef-src-n-attribute title="<src-n-attribute>">&lt;src-n-attribute&gt;</a> production.
			</ul>

		<li>
			If <var>candidate attributes</var> is empty,
			return the result of <a data-link-type=dfn href=#obtain-a-candidate-from-srcobtaining-a-candidate-from-src title="obtaining a candidate from src">obtaining a candidate from src</a> from the element
			and abort this algorithm.

		<li>
			For each <var>candidate attribute</var>,
			let its <var>index</var> be the result of removing the first four characters from the attribute name,
			and interpreting the remaining characters as a base-10 number.

		<li>
			Sort the <var>candidate attributes</var> by their <var>index</var> in ascending order.

		<li>
			For each <var>candidate attribute</var>:

			<ol>
				<li>
					If the attribute’s value contains a media query,
					evaluate that query.
					If it returns true,
					let <var>winning value</var> be the value of this attribute following the media query
					and abort this sub-algorithm.
					Otherwise, if it returns false,
					abort this sub-algorithm.

				<li>
					Otherwise, let <var>winning value</var> be this attribute’s value
					and abort this sub-algorithm.
			</ol>

		<li>
			If there is no <var>winning value</var>,
			return the result of <a data-link-type=dfn href=#obtain-a-candidate-from-srcobtaining-a-candidate-from-src title="obtaining a candidate from src">obtaining a candidate from src</a> from the element
			and abort this algorithm.

		<li>
			Let <var>image candidates</var> be an initially empty list.

		<li>
			If the <var>winning value</var> conforms to the <a class="production css-code" data-link-type=type href=#typedef-x-based-urls title="<x-based-urls>">&lt;x-based-urls&gt;</a> production,
			then for each set of values between commas:

			<ol>
				<li>
					Let <var>candidate</var> be an <a data-link-type=dfn href=#image-candidate title="image candidate">image candidate</a> with its url being the <a class="production css-code" data-link-type=type href=http://dev.w3.org/csswg/css-values-3/#url-value title="<url>">&lt;url&gt;</a> from the current set of values.

				<li>
					If the current set of values contains a <a class="production css-code" data-link-type=type href=http://dev.w3.org/csswg/css-values-3/#resolution-value title="<resolution>">&lt;resolution&gt;</a>,
					let <var>candidate’s</var> resolution be that resolution.

				<li>
					Otherwise, let <var>candidate’s</var> resolution be <span class=css data-link-type=maybe title=1x>1x</span>.

				<li>
					Append <var>candidate</var> to <var>image candidates</var>.
			</ol>

<p>			Return <var>image candidates</var>,
			and abort this algorithm.

		<li>
			Otherwise,
			the <var>winning value</var> conforms to the <a class="production css-code" data-link-type=type href=#typedef-viewport-urls title="<viewport-urls>">&lt;viewport-urls&gt;</a> production.

		<li>
			Let <var>viewport data</var> be the portion of <var>winning value</var> that conforms to the <a class="production css-code" data-link-type=type href=#typedef-size-viewport-list title="<size-viewport-list>">&lt;size-viewport-list&gt;</a> production.
			Let <var>unprocessed candidates</var> be the portion of the <var>winning value</var> that conforms to the <a class="production css-code" data-link-type=type href=#typedef-size-based-urls title="<size-based-urls>">&lt;size-based-urls&gt;</a> production.

		<li>
			Divide <var>viewport data</var> into adjacent pairs of values,
			and a final lone value.

<p>			For each pair of values in <var>viewport data</var>:

			<ol>
				<li>
					Let <var>candidate viewport width</var> be the result of intepreting the second value as a <a class="production css-code" data-link-type=type href=http://dev.w3.org/csswg/css-values-3/#length-value title="<length>">&lt;length&gt;</a>,
					using the same rules as a <a class="production css-code" data-link-type=type href=http://dev.w3.org/csswg/css-values-3/#length-value title="<length>">&lt;length&gt;</a> in a <span class=css data-link-type=maybe title=min-width>min-width</span> media feature.

				<li>
					If the viewport’s width is less than <var>candidate viewport width</var>,
					then:

<p>					<ul>
						<li>
							If the first value is a <a class="production css-code" data-link-type=type href=http://dev.w3.org/csswg/css-values-3/#number-value title="<number>">&lt;number&gt;</a>,
							let <var>winning image width</var> be a length equal to that number of pixels.

						<li>
							Otherwise, the first value is a <a class="production css-code" data-link-type=type href=http://dev.w3.org/csswg/css-values-3/#percentage-value title="<percentage>">&lt;percentage&gt;</a>.
							Let <var>winning image width</var> be a length equal to the given percentage of the viewport’s width.
					</ul>

<p>					Abort this sub-algorithm.
			</ol>

		<li>
			For each set of values between commas of <var>unprocessed candidates</var>:

			<ol>
				<li>
					Let <var>candidate</var> be an <a data-link-type=dfn href=#image-candidate title="image candidate">image candidate</a> with its url being the <a class="production css-code" data-link-type=type href=http://dev.w3.org/csswg/css-values-3/#url-value title="<url>">&lt;url&gt;</a> from the current set of values.

				<li>
					Let <var>candidate’s</var> resolution be the result of dividing the <a class="production css-code" data-link-type=type href=http://dev.w3.org/csswg/css-syntax-3/#typedef-integer title="<integer>">&lt;integer&gt;</a> from the current set of values
					by the <var>winning image width</var>, as an <span class=css data-link-type=maybe title=x>x</span> unit.

				<li>
					Append <var>candidate</var> to <var>image candidates</var>.
			</ol>

<p>			Return <var>image candidates</var>.
	</ol>

<p>	To <dfn data-dfn-type=dfn data-noexport="" id=obtain-a-candidate-from-srcobtaining-a-candidate-from-src title="obtain a candidate from src|obtaining a candidate from src">obtain a candidate from src<a class=self-link href=#obtain-a-candidate-from-srcobtaining-a-candidate-from-src></a></dfn> from an element,
	follow these steps:

	<ol>
		<li>
			If the element has a <code>src</code> attribute,
			return a list consisting of a single <a data-link-type=dfn href=#image-candidate title="image candidate">image candidate</a>,
			where that candidate’s url is the value of the <code>src</code> attribute
			and its resolution is <span class=css data-link-type=maybe title=1x>1x</span>.

		<li>
			Otherwise,
			return an empty list.
	</ol>

	<p class=issue id=issue-04b28ba9><a class=self-link href=#issue-04b28ba9></a>
		In the event that this proposal "wins",
		but browsers have already shipped "basic" <code>srcset</code>
		(just support for resolution discrimination)
		and uptake is high enough that they can’t take it back,
		then we can easily integrate <code>srcset</code> into this fallback behavior.
		In other words, <code>srcset</code> doesn’t hurt this proposal
		(though it would be ideal if it didn’t exist alongside).
<h2 class="no-num no-ref heading settled heading" id=references><span class=content>
References</span><a class=self-link href=#references></a></h2>

<h3 class="no-num no-ref heading settled heading" id=normative><span class=content>
Normative References</span><a class=self-link href=#normative></a></h3>
<div data-fill-with=normative-references><dl><dt id=css3val title=CSS3VAL><a class=self-link href=#css3val></a>[CSS3VAL]<dd>Håkon Wium Lie; Tab Atkins; Elika J. Etemad. <a href=http://www.w3.org/TR/2013/CR-css3-values-20130730/>CSS Values and Units Module Level 3</a>. 30 July 2013. W3C Candidate Recommendation. (Work in progress.) URL: <a href=http://www.w3.org/TR/2013/CR-css3-values-20130730/>http://www.w3.org/TR/2013/CR-css3-values-20130730/</a></dl></div>

<h3 class="no-num no-ref heading settled heading" id=informative><span class=content>
Informative References</span><a class=self-link href=#informative></a></h3>
<div data-fill-with=informative-references><dl></dl></div>

<h2 class="no-num no-ref heading settled heading" id=index><span class=content>
Index</span><a class=self-link href=#index></a></h2>
<div data-fill-with=index><ul class=indexlist>
<li>art-direction, <a href=#art-direction title="section 2">2</a>
<li>image candidate, <a href=#image-candidate title="section 4.1">4.1</a>
<li>&lt;image-size&gt;, <a href=#typedef-image-size title="section 3">3</a>
<li>obtain a candidate from src, <a href=#obtain-a-candidate-from-srcobtaining-a-candidate-from-src title="section 4.1">4.1</a>
<li>obtaining a candidate from src, <a href=#obtain-a-candidate-from-srcobtaining-a-candidate-from-src title="section 4.1">4.1</a>
<li>obtaining the image candidates, <a href=#obtain-the-image-candidatesobtaining-the-image-candidates title="section 4.1">4.1</a>
<li>obtain the image candidates, <a href=#obtain-the-image-candidatesobtaining-the-image-candidates title="section 4.1">4.1</a>
<li>resolution, <a href=#resolution0 title="section 2">2</a>
<li>&lt;size-based-urls&gt;, <a href=#typedef-size-based-urls title="section 3">3</a>
<li>&lt;size-viewport-list&gt;, <a href=#typedef-size-viewport-list title="section 3">3</a>
<li>src-N, <a href=#src-n--src-n-attribute title="section 3">3</a>
<li>src-N attribute, <a href=#src-n--src-n-attribute title="section 3">3</a>
<li>&lt;src-n-attribute&gt;, <a href=#typedef-src-n-attribute title="section 3">3</a>
<li>viewport, <a href=#viewport0 title="section 2">2</a>
<li>&lt;viewport-size&gt;, <a href=#typedef-viewport-size title="section 3">3</a>
<li>&lt;viewport-urls&gt;, <a href=#typedef-viewport-urls title="section 3">3</a>
<li>&lt;x-based-urls&gt;, <a href=#typedef-x-based-urls title="section 3">3</a>
</ul></div>

<h2 class="no-num no-ref heading settled heading" id=property-index><span class=content>
Property index</span><a class=self-link href=#property-index></a></h2>
<div data-fill-with=property-index><p>No properties defined.</div>


<h2 class="no-num heading settled" id=issues-index><span class=content>Issues Index</span><a class=self-link href=#issues-index></a></h2><div style="counter-reset: issue"><p class=issue>
		I want just the second clause of the <code>media_query</code> grammar in Media Queries 4,
		where you have "(foo:bar) and (baz:qux)" and that’s it.
		I should go fix the grammar section there to expose this more cleanly.

<a href=#issue-06cc56d0> ↵ </a><p class=issue>
		Assume that I’ve already edited Images 4 appropriately so that <span class=css data-link-type=maybe title=x>x</span> is a valid resolution unit,
		equivalent to <span class=css data-link-type=maybe title=dppx>dppx</span>.

	<a href=#issue-8c2c662b> ↵ </a><p class=issue>
				Is this the right place to say "fire a load error" or whatever?

		<a href=#issue-fc5e642a> ↵ </a><p class=issue>
				Update the image data, choose the right candidate, etc, etc, hook up to the right terms in HTML.
				The actual choice is UA-specific.
	<a href=#issue-e3021f25> ↵ </a><p class=issue>
		In the event that this proposal "wins",
		but browsers have already shipped "basic" <code>srcset</code>
		(just support for resolution discrimination)
		and uptake is high enough that they can’t take it back,
		then we can easily integrate <code>srcset</code> into this fallback behavior.
		In other words, <code>srcset</code> doesn’t hurt this proposal
		(though it would be ideal if it didn’t exist alongside).
<a href=#issue-04b28ba9> ↵ </a></div>
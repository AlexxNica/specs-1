<!DOCTYPE html><html lang=en><head>
	<meta content="text/html; charset=utf-8" http-equiv=Content-Type>
	<title>Proposal for RespImg Syntax</title>
	<link href=../common/default.css rel=stylesheet type=text/css>
	<link href=http://dev.w3.org/csslogo.ico rel="shortcut icon" type=image/x-icon>
	<meta content=summary name=twitter:card>
	<meta content="Proposal for RespImg Syntax" name=twitter:title>
	<meta content='This document describes a proposed syntax for "responsive images", which allows a user agent to choose an appropriate version of an image from several candidates.' name=twitter:description>
	<meta content=@tabatkins name=twitter:creator>
	<script src=../common/prism.js></script>
	<script>
	window.findAll = window.findAll || function(sel){ return [].slice.call(document.querySelectorAll(sel)) };
	Function.prototype.aritize = function(numArgs) {
		var fn = this;
		return function() {
			var args = [].slice.call(arguments, 0, numArgs);
			return fn.apply(this, args);
		}
	};
	window.addEventListener('load', function() {
		findAll(".example pre:not(.literal), pre[class*='lang-'], pre[class*='language-']")
			.map(Prism.highlightElement.aritize(1));
	}, false);
	</script>
	<link href=../common/prism.css rel=stylesheet type=text/css>
	<style>
body { 
	background: white url(http://www.w3.org/StyleSheets/TR/logo-unofficial.png) top left no-repeat fixed; 
	font-family: sans-serif;
	color: black;
}

:link { color: #00C; }
:visited { color: #609; }
a[href]:active { color: #C00; }
a[href]:hover { background: #ffa; }
a img { border: none; }

h1, h2, h3 { color: #005A9C; }
h1 { font: 170% sans-serif }
h2 { font: 140% sans-serif }
h3 { font: 120% sans-serif }
h4 { font: bold 100% sans-serif }
h5 { font: italic 100% sans-serif }
h6 { font: small-caps 100% sans-serif }

div.head { margin-bottom: 1em }
div.head h1 { margin-top: 2em; clear: both }
div.head table { margin-left: 2em; margin-top: 2em }

p.copyright { font-size: small }
p.copyright small { font-size: small }

ul.toc, ol.toc {
	list-style: none;
}

pre { margin-left: 2em }

dt { font-weight: bold }

[data-autolink="property"]::before, [data-autolink="maybe"]::before {content: "\2018";}
[data-autolink="property"]::after, [data-autolink="maybe"]::after {content: "\2019";}

.example .language-css, .example .language-markup {
	background: transparent;
}
	</style>
</head>
<body class="h-entry lang-css">
<div class=head>
	<p data-fill-with=logo></p>
	<h1 class="p-name no-ref" id=title>Proposal for RespImg Syntax</h1>
	<h2 class="no-num no-toc no-ref heading settled heading" id=subtitle><span class=content>Unofficial Proposal Draft,
		<span class=dt-updated><span class=value-title title=20140211>11 February 2014</span></span></span></h2>
	<div data-fill-with=spec-metadata><dl><dt>This version:<dd><a class=u-url href=http://www.w3.org/TR/2014/UD-respimg-1-20140211/>http://www.w3.org/TR/2014/UD-respimg-1-20140211/</a><dt>Editor’s Draft:<dd><a href=http://tabatkins.github.io/specs/respimg/Overview.html>http://tabatkins.github.io/specs/respimg/Overview.html</a>
    <dt>Feedback:</dt>
        <dd><a href="mailto:public-respimg@w3.org?subject=%5Brespimg%5D%20feedback">public-respimg@w3.org</a>
            with subject line
            “<kbd>[respimg] <var>… message topic …</var></kbd>”(<a href=http://lists.w3.org/Archives/Public/public-respimg/ rel=discussion>archives</a>)<dt>Test Suite:<dd>None Yet<dt>Editors:
<dd class="p-author h-card vcard"><a class="p-name fn u-url url" href=http://xanthir.com/contact/>Tab Atkins</a> (<span class="p-org org">Google</span>)</dl></div>
	<div data-fill-with=warning><details class=annoying-warning open>
	<summary>This Document Is Obsolete and Has Been Replaced</summary>
	<p>
		This specification is obsolete and has been replaced by the document at <a href=http://picture.responsiveimages.org/>http://picture.responsiveimages.org/</a>.
		Do not attempt to implement this specification.
		Do not refer to this specification except as a historical artifact.
</details>
</div>
	<p class=copyright data-fill-with=copyright><a href=http://creativecommons.org/publicdomain/zero/1.0/ rel=license><img alt=CC0 src=http://i.creativecommons.org/p/zero/1.0/80x15.png></a>
To the extent possible under law, the editors have waived all copyright 
and related or neighboring rights to this work. 
In addition, as of 11 February 2014, 
the editors have made this specification available under the
<a href=http://www.openwebfoundation.org/legal/the-owf-1-0-agreements/owfa-1-0 rel=license>Open Web Foundation Agreement Version 1.0</a>,
which is available at http://www.openwebfoundation.org/legal/the-owf-1-0-agreements/owfa-1-0.
Parts of this work may be from an existing specification document.  If so, those parts are instead covered by the license of the existing specification document.</p>
	<hr title="Separator for header">
</div>

<h2 class="no-num no-toc no-ref heading settled heading" id=abstract><span class=content>Abstract</span></h2>
<p class=p-summary data-fill-with=abstract>This document describes a proposed syntax for "responsive images", which allows a user agent to choose an appropriate version of an image from several candidates.</p>

<h2 class="no-num no-toc no-ref heading settled heading" id=status><span class=content>Status of this document</span></h2>
<div data-fill-with=status><p>
	This is an unofficial draft.
	It is provided for discussion only and may change at any moment.
	Its publication here does not imply endorsement of its contents by W3C. 
	Don’t cite this document other than as work in progress.</div>
<div data-fill-with=at-risk></div>

<h2 class="no-num no-toc no-ref heading settled heading" id=contents><span class=content>Table of contents</span></h2>
<div data-fill-with=table-of-contents><ul class=toc><li><a href=#intro><span class=secno>1</span>
Introduction</a><li><a href=#problem><span class=secno>2</span>
The Problem Statement</a><li><a href=#syntax><span class=secno>3</span>
The Syntax Proposal</a><ul class=toc><li><a href=#media-queries><span class=secno>3.1</span>
Art Direction</a><li><a href=#resolution><span class=secno>3.2</span>
Resolution</a><li><a href=#variable-size><span class=secno>3.3</span>
Variable-Sized Images</a></ul><li><a href=#model><span class=secno>4</span>
Processing Model</a><ul class=toc><li><a href=#obtain-candidates><span class=secno>4.1</span>
Obtaining the Image Candidates</a></ul><li><a href=#references><span class=secno></span>
References</a><ul class=toc><li><a href=#normative><span class=secno></span>
Normative References</a><li><a href=#informative><span class=secno></span>
Informative References</a></ul><li><a href=#index><span class=secno></span>
Index</a><li><a href=#property-index><span class=secno></span>
Property index</a><li><a href=#issues-index><span class=secno></span>Issues Index</a></ul></div>



<h2 class="heading settled heading" data-level=1 id=intro><span class=secno>1 </span><span class=content>
Introduction</span><a class=self-link href=#intro></a></h2>

<p>	The Responsive Images community has been trying for some time to come up with a syntax for specifying responsive images
	that satisfies multiple use-cases.
	Their most popular attempt so far,
	the <code>&lt;picture&gt;</code> element,
	only hits 2 of the 3 major use-cases,
	and has certain aspects that implementors seem to be rather unhappy with.

<p>	This document defines a new attempt at the problem,
	sketched out in collaboration between me and John Mellor,
	which solves all three of the major use-cases,
	while avoiding implementor concerns,
	and hopefully being very easily usable.

<h2 class="heading settled heading" data-level=2 id=problem><span class=secno>2 </span><span class=content>
The Problem Statement</span><a class=self-link href=#problem></a></h2>

<p>	To make things somewhat clearer,
	I’ll outline here the three use-cases that the responsive images community has been attempting to address.

	<ol>
		<li>
			<dfn data-dfn-type=dfn data-noexport="" id=resolution0 title=resolution>Resolution-based discrimination<a class=self-link href=#resolution0></a></dfn> - providing the same image in multiple resolutions,
			so that high-res devices can get the prettiest picture,
			while low-res or low-bandwidth devices can avoid wasting time and bandwidth with overly-large files.

		<li>
			<dfn data-dfn-type=dfn data-noexport="" id=art-direction title=art-direction>Art-direction discrimination<a class=self-link href=#art-direction></a></dfn> - as the screen size changes,
			so might your page’s design.
			A large, detailed image might be appropriate for the desktop design,
			but just scaling it down for a small phone’s screen results in a tiny, cluttered image.
			Instead, you may want to provide alternate images,
			cropped differently to better fit the small screen
			and still show the most important parts of the image at an appropriate size.

		<li>
			<dfn data-dfn-type=dfn data-noexport="" id=viewport title=viewport>Variable-size resolution discrimination<a class=self-link href=#viewport></a></dfn> -
			sometimes the image you’re serving is variable-sized:
			either based on the size of the viewport
			or just different sizes at different breakpoints.
			A combination of the solutions to the above two problems <em>can</em> address this,
			but very verbosely -
			you have to do math to figure out breakpoints
			(not intrinsically related to your site’s breakpoints)
			and repeat urls multiple times.
			For example, a 1000px wide image might be appropriate as a 1x image
			when used to fill the background of the page on a desktop screen,
			but it’s far too large to use for the same purpose on a 320px wide screen.
			On a screen that small, it’s more like a 2x or 3x image.
	</ol>

<p>	In addition, there’s a strong requirement that the solution be friendly to the browser’s preloader,
	which scans the document for urls to start downloading quickly,
	as the connection delay is a huge factor in the feeling of "slow" sites on mobile devices,
	and so starting the connection as early as possible is a big win in perceived performance.
	This limits what kind of information you can rely on,
	as the preloader only has access to a small amount of data from the page.

<h2 class="heading settled heading" data-level=3 id=syntax><span class=secno>3 </span><span class=content>
The Syntax Proposal</span><a class=self-link href=#syntax></a></h2>

<p>	Add a set of attributes to <code>&lt;img&gt;</code>,
	named <code>src-1</code>, <code>src-2</code>, etc.
	Collectively,
	these are the <dfn data-dfn-type=dfn data-export="" id=src-n- title="src-N | src-N attribute">src-N attributes<a class=self-link href=#src-n-></a></dfn>

<p>	When loading an image,
	these attributes are consulted first,
	in numerical order.
	If none of them are valid or match,
	then the plain <code>src</code> attribute is used to load the image.

<p class=note>	Note: It’s possible to integrate <code>srcset</code> into this if necessary,
	but it would be nice to avoid doing that.
	This completely replaces the <code>srcset</code> funtionality.

<p>	The grammar for the attributes is:

	<pre>  <dfn class=css-code data-dfn-type=type data-export="" id=typedef-src-n-attribute>&lt;src-n-attribute&gt;<a class=self-link href=#typedef-src-n-attribute></a></dfn> = <a class="production css-code" data-link-type=type href=http://dev.w3.org/csswg/mediaqueries-4/#typedef-media-query title="<media-query>">&lt;media-query&gt;</a>? [ <a class="production css-code" data-link-type=type href=#typedef-x-based-urls title="<x-based-urls>">&lt;x-based-urls&gt;</a> | <a class="production css-code" data-link-type=type href=#typedef-viewport-urls title="<viewport-urls>">&lt;viewport-urls&gt;</a> ]
  <dfn class=css-code data-dfn-type=type data-export="" id=typedef-x-based-urls>&lt;x-based-urls&gt;<a class=self-link href=#typedef-x-based-urls></a></dfn> = [ <a class="production css-code" data-link-type=type href=http://dev.w3.org/csswg/css-values-3/#url-value title="<url>">&lt;url&gt;</a> <a class="production css-code" data-link-type=type href=http://dev.w3.org/csswg/css-values-3/#resolution-value title="<resolution>">&lt;resolution&gt;</a>? ]#

  <dfn class=css-code data-dfn-type=type data-export="" id=typedef-viewport-urls>&lt;viewport-urls&gt;<a class=self-link href=#typedef-viewport-urls></a></dfn> = <a class="production css-code" data-link-type=type href=#typedef-size-viewport-list title="<size-viewport-list>">&lt;size-viewport-list&gt;</a> ; <a class="production css-code" data-link-type=type href=#typedef-size-based-urls title="<size-based-urls>">&lt;size-based-urls&gt;</a>
  <dfn class=css-code data-dfn-type=type data-export="" id=typedef-size-viewport-list>&lt;size-viewport-list&gt;<a class=self-link href=#typedef-size-viewport-list></a></dfn> = <a class="production css-code" data-link-type=type href=#typedef-image-size title="<image-size>">&lt;image-size&gt;</a> [ ( <a class="production css-code" data-link-type=type href=#typedef-viewport-size title="<viewport-size>">&lt;viewport-size&gt;</a> ) <a class="production css-code" data-link-type=type href=#typedef-image-size title="<image-size>">&lt;image-size&gt;</a> ]*
  <dfn class=css-code data-dfn-type=type data-export="" id=typedef-image-size>&lt;image-size&gt;<a class=self-link href=#typedef-image-size></a></dfn> = <a class="production css-code" data-link-type=type href=http://dev.w3.org/csswg/css-values-3/#length-value title="<length>">&lt;length&gt;</a> | <a class="production css-code" data-link-type=type href=http://dev.w3.org/csswg/css-values-3/#percentage-value title="<percentage>">&lt;percentage&gt;</a>
  <dfn class=css-code data-dfn-type=type data-export="" id=typedef-viewport-size>&lt;viewport-size&gt;<a class=self-link href=#typedef-viewport-size></a></dfn> = <a class="production css-code" data-link-type=type href=http://dev.w3.org/csswg/css-values-3/#length-value title="<length>">&lt;length&gt;</a>
  <dfn class=css-code data-dfn-type=type data-export="" id=typedef-size-based-urls>&lt;size-based-urls&gt;<a class=self-link href=#typedef-size-based-urls></a></dfn> = [ <a class="production css-code" data-link-type=type href=http://dev.w3.org/csswg/css-values-3/#url-value title="<url>">&lt;url&gt;</a> <a class="production css-code" data-link-type=type href=http://dev.w3.org/csswg/css-syntax-3/#typedef-integer title="<integer>">&lt;integer&gt;</a> ]#
</pre>
<p>	The above grammar must be interpreted per the grammar definition in <a data-biblio-type=normative data-link-type=biblio href=#css3val title=css3val>[CSS3VAL]</a>.
	For the purposes of the above grammar,
	the <a class="production css-code" data-link-type=type href=http://dev.w3.org/csswg/css-values-3/#url-value title="<url>">&lt;url&gt;</a> production is simply any sequence of non-<a data-link-spec=css-syntax data-link-type=dfn href=http://dev.w3.org/csswg/css-syntax-3/#whitespace title=whitespace>whitespace</a> characters
	that does not end in a comma or semicolon.
	All other terminal productions are defined as per CSS.

<p>	The terms and use of this grammar are explained further in the following sections.

<p class=note>	Note: Any explanations of how the attributes and their values are processed that appear in this section are <em>non-normative</em>.
	The normative definition of the processing model is in the "Processing" section.

<h3 class="heading settled heading" data-level=3.1 id=media-queries><span class=secno>3.1 </span><span class=content>
Art Direction</span><a class=self-link href=#media-queries></a></h3>

<p>	To solve the basic <a data-link-type=dfn href=#art-direction title=art-direction>art-direction</a> use-case,
	the <a data-link-type=dfn href=#src-n- title="src-n attributes">src-N attributes</a> allow a media query to be provided at the beginning of their value.

	<p class=issue id=issue-c4f912a2><a class=self-link href=#issue-c4f912a2></a>
		I want just the second clause of the <code>media_query</code> grammar in Media Queries 4,
		where you have "(foo:bar) and (baz:qux)" and that’s it.
		I should go fix the grammar section there to expose this more cleanly.

<p>	Each valid <a data-link-type=dfn href=#src-n- title="src-n attribute">src-N attribute</a> is checked in numerical order,
	and the first one to have a matching media query
	(or no media query at all)
	is chosen as the source of candidate urls for this <code>&lt;img&gt;</code>.

	<div class=example>
		The following three crops of the same image can be used on various screen sizes,
		where different designs call for different image shapes and sizes:

		<figure>
			<img alt="Three crops of the same image. The first shows President Obama talking to a soldier in hospital scrubs. The second is zoomed out, showing more soldiers standing around them.  The third is zoomed out even further, showing even more soldiers and more of the hospital room." src=images/difimages.jpg>
		</figure>

<p>		These could be referenced like:

		<pre class=lang-markup>  &lt;img src-1="(max-width: 400px) pic-small.jpg"
       src-2="(max-width: 1000px) pic-medium.jpg"
       src="pic-large.jpg"
       alt="Obama talking to a soldier in hospital scrubs."&gt;
</pre>
<p class=note>		Note: Putting the final url into a <code>src</code> attribute like that isn’t required;
		in fact, if using any of the more advanced pieces of this feature,
		like multiple resolutions,
		it would <em>have</em> to be in a <a data-link-type=dfn href=#src-n- title="src-n attribute">src-N attribute</a>
		(using <code>src-3</code> would be most appropriate here).
		Still, having a final fallback in <code>src</code> is a good idea,
		as it means that down-level browsers will still be able to correctly download the image.
	</div>

<p class=note>	Note: This feature is intended to be used with <em>distinct</em> images.
	Look at the "Viewport" subsection about choosing among multiple copies of the <em>same</em> image
	based on viewport size.

<h3 class="heading settled heading" data-level=3.2 id=resolution><span class=secno>3.2 </span><span class=content>
Resolution</span><a class=self-link href=#resolution></a></h3>

<p>	To solve the <a data-link-type=dfn href=#resolution0 title=resolution>resolution</a> use-case,
	the <a data-link-type=dfn href=#src-n- title="src-n attributes">src-N attributes</a> allow multiple urls to be provided,
	each with an indicator of their resolution
	(the ratio of image pixels to CSS pixels).

<p>	Instead of a single url,
	simply provide a comma-separated list of urls/resolution pairs,
	where each pair is a url, followed by whitespace, followed by a CSS <a class="production css-code" data-link-type=type href=http://dev.w3.org/csswg/css-values-3/#resolution-value title="<resolution>">&lt;resolution&gt;</a> value.
	A url provided without a <a class="production css-code" data-link-type=type href=http://dev.w3.org/csswg/css-values-3/#resolution-value title="<resolution>">&lt;resolution&gt;</a> is assumed to be at <span class=css data-link-type=maybe title=1x>1x</span> resolution.

	<p class=issue id=issue-507e8b4c><a class=self-link href=#issue-507e8b4c></a>
		Assume that I’ve already edited Images 4 appropriately so that <span class=css data-link-type=maybe title=x>x</span> is a valid resolution unit,
		equivalent to <span class=css data-link-type=maybe title=dppx>dppx</span>.

	<div class=example>
		For example, the following code provides the same image at three different resolutions:
		one at "normal size",
		where each image pixel maps to one CSS pixel;
		one "high-res",
		which is double the size but meant to be displayed with two image pixels for every one CSS pixel;
		and one "low-res",
		which is half the size,
		intended for low-bandwidth situations.

		<pre class=lang-markup>  &lt;img src-1="pic.png, picHigh.png 2x, picLow.png .5x"&gt;
</pre>	</div>

<p>	The choice of which image to load is left to the user agent,
	based on its knowledge of the screen’s pixel density,
	the device’s bandwidth,
	and whatever other factors it deems relevant to the decision.

<p>	The intrinsic size of the chosen image is equal to the actual number of image pixels in each dimension,
	divided by the chosen resolution multiplier,
	in CSS px units.
	For example, if "pic1.png 2x" is chosen, and is 100 pixels wide,
	its intrinsic size is <span class=css data-link-type=maybe title=50px>50px</span>.

<h3 class="heading settled heading" data-level=3.3 id=variable-size><span class=secno>3.3 </span><span class=content>
Variable-Sized Images</span><a class=self-link href=#variable-size></a></h3>

<p>	The previous section on resolution discrimination had a hidden assumption which may not always be true:
	that the image being presented is meant to be a single, static size.
	That is, regardless of the size of the screen, the image will always be, say, 400px wide.

<p>	This assumption is not always true.
	There are two major reasons why this may be so:

<p>	<ul>
		<li>
			The image’s size may be specified as a percentage of the viewport’s width.
			For example, it may be screen-filling (100%),
			or it may fill a column in a two-column layout (50%).

		<li>
			The image’s size may vary with your page’s breakpoints,
			as it gets placed in different layouts.
			For example,
			you may have a single-column layout on small screens,
			having the image fill that column (100%),
			but switch to a grid with fixed-size items in it on larger screens (400px).
	</ul>

<p>	Either of these issues can be addressed with Media Queries,
	but it gets complicated when resolution discrimination is mixed in -
	if you’re displaying the same image at a variety of sizes,
	a particular image file may be appropriate as a <span class=css data-link-type=maybe title=1x>1x</span> image on large screens,
	but would also serve perfectly well as a <span class=css data-link-type=maybe title=2x>2x</span> image on smaller screens.
	Dealing with this requires you to repeat urls multiple times,
	and can require some non-trivial math.
	(See <a href=#bad-example-multisize>the next example</a> for a simple demonstration of the code bloat.)
	Further, the code so produced is not actually forward-compatible, either -
	it’ll act badly when even higher-density screens arrive,
	unless you further bloat the syntax by pre-emptively writing out higher-density versions.

<p>	To avoid these issues,
	this specification defines a <strong>shortcut syntax</strong>
	to address the case of a variable-sized image.

<p>	For the first case,
	of an image that is sized as a fraction of the viewport,
	simply provide the target <code>&lt;img&gt;</code> size as a percentage,
	followed by a semicolon,
	followed by a comma-separated list of image urls
	<em>and the widths of the images in image pixels</em>.
	Using this information, the browser can determine how wide the <code>&lt;img&gt;</code> will end up being,
	and convert the image widths into <em>effective densities</em>.

	<div class=example>
		For example, say you have an image in two sizes, one 400 pixels wide and one 800 pixels wide.
		If you specified <code class=lang-markup>&lt;img src-1="100%; url1 400, url2 800"&gt;</code>,
		and the viewport’s width was 320px,
		this is equivalent to specifying <code class=lang-markup>&lt;img src-1="url1 1.25x, url2 2.5x"&gt;</code>.

<p>		On the other hand, if the viewport’s width was 800px,
		it would be equivalent to specifying <code class=lang-markup>&lt;img src-1="url1 .5x, url2 1x"&gt;</code>.

<p>		Regardless of the viewport’s size,
		the browser will understand which url is appropriate to download
		without you having to do any of the math yourself.
	</div>

	<div class=example>
		Here’s a more complete example,
		with image sizes spanning the full range of appropriate values
		for screens from small phones to large desktop monitors.

		<pre class=lang-markup>  &lt;img src-1="100%; pic1.png 160, pic2.png 320, pic3.png 640,
                   pic4.png 1280, pic5.png 2560"&gt;
</pre>
<p>		With this one declaration,
		a high-res phone 320px wide can correctly choose to download <code>pic3.png</code> (an effective 2x resolution),
		while a large desktop screen with 96dpi will correctly choose to download <code>pic4.png</code> (approximately a 1x resolution).
		Anything at higher, lower, or in-between sizes and resolutions will also be appropriately catered for,
		without the author having to explicitly figure out reasonable breakpoints
		and categorize each image appropriately for each.

<p>		Using just Media Queries,
		the markup would instead look something like:

		<pre class=lang-markup id=bad-example-multisize>  &lt;img src-1="(max-width: 400px) pic1.png .5x, pic2.png 1x, pic3.png 2x"
       src-2="(max-width: 800px) pic2.png .5x, pic3.png 1x, pic4.png 2x"
       src-3="(max-width: 1600px) pic3.png .5x, pic4.png 1x, pic5.png 2x"
       src-4="pic4.png .5x, pic5.png 1x"&gt;
</pre>
<p>		This example is obviouslly substantially more verbose,
		and also less powerful.
		For example, when screens reach 3x or 4x density,
		those devices will still be stuck downloading 2x resources,
		even though a 3x or 4x version exists for most screen sizes,
		unless the author comes back and updates every <code>&lt;img&gt;</code> element in their page.

<p>		Further, the breakpoints chosen above were simply guessed at,
		and are likely not optimal.
		Doing the math to find the optimal breakpoints isn’t hard, but is definitely non-trivial.
	</div>

<p>	For the second case, when the size of the image varies based on breakpoints in your layout,
	the syntax is slightly more complicated.
	The first and second parts are still separated by a semicolon,
	and the second part is still a list of urls and image sizes.

<p>	The syntax of the first part, though, is slightly expanded.
	Rather than being simply an image size,
	it’s an alternating list of image sizes and viewport breakpoints,
	with the breakpoints in parentheses to help separate them visually.
	The breakpoints must be in ascending order,
	as the image size is chosen by finding which two breakpoints the viewport’s size sits between,
	and selecting the image size between those two.

	<div class=example>
		For example, say your site had three basic layouts:

		<figure>
			<img src=images/viewport_selection_mob_first.jpg>
			<figcaption>
				Single-column (100%) on small screens,
				two-column (50%) on medium screens,
				and three-column (approximately 33%) on large screens.
			</figcaption>
		</figure>

<p>		Assuming that the same image is supposed to be used at all of these layouts
		(that is, you aren’t doing <a data-link-type=dfn href=#art-direction title=art-direction>art-direction</a> cropping to optimize the display of the image for a given size),
		then all of these cases can be addressed by a handful of images at various sizes,
		and the following code:

		<pre class=lang-markup>  &lt;img src-1="100% (30em) 50% (50em) calc(33% - 100px);
             pic100.png 100, pic200.png 200, pic400.png 400,
             pic800.png 800, pic1600.png 1600, pic3200.png 3200"&gt;
</pre>
<p>		The first part of this attribute sets up the layout breakpoints at <span class=css data-link-type=maybe title=30em>30em</span> and <span class=css data-link-type=maybe title=50em>50em</span>,
		and declares the image sizes between and around these breakpoints to be <span class=css data-link-type=maybe title=100%>100%</span>, <span class=css data-link-type=maybe title=50%>50%</span>, or <span class=css data-link-type=maybe title="calc(33% - 100px)">calc(33% - 100px)</span>.

<p>		The six images automatically cover every reasonable possibility.
		For small screens (phone size, or even smaller, like watches),
		anything from the 100 pixel wide image to the 800 pixel wide image may be downloaded,
		depending on screen size and density.
		For medium and large screens,
		anything from the 400 pixel wide image and up may be chosen.
		The author doesn’t have to do any math or complex figuring,
		just provide the image in enough sizes to cover everything they believe reasonable.

<p>		Again, doing the same thing just with Media Queries is much more verbose.
	</div>

<p class=note>	Note: Notice that the full set of CSS <a class="production css-code" data-link-type=type href=http://dev.w3.org/csswg/css-values-3/#length-value title="<length>">&lt;length&gt;</a> values are actually available for image sizes,
	including things like <a class=css data-link-type=maybe href=http://dev.w3.org/csswg/css-values-3/#calc title=calc()>calc()</a>.
	Using this, you can get as close to the precise size that the <code>&lt;img&gt;</code> element will be as you wish,
	though just getting “close enough” as I did in these examples is more than sufficient in most cases.
	Similarly, viewport sizes can be specified with the full set of <a class="production css-code" data-link-type=type href=http://dev.w3.org/csswg/css-values-3/#length-value title="<length>">&lt;length&gt;</a> values,
	which are interpreted in the same way that they would be in a Media Query like <span class=css data-link-type=maybe title=min-width>min-width</span>.
	For example, <span class=css data-link-type=maybe title=em>em</span> units are interpreted relative to the user’s default font size, etc.

<p class=note>	Note: Also, all of the examples given here size the various images as powers of 2,
	doubling in size as they get larger.
	This is merely for convenience, as it’s easy to downsample an image by powers of 2,
	but is not a limitation -
	feel free to provide images at any size you desire.
	This will become more important in time,
	as 3x screens come into use
	and you wish to give them a well-targeted image to download,
	rather than having to decide between the 2x and 4x versions.

<p>	The intrinsic width of the image is equal to the image size chosen from the provided list.
	If the image has an intrinsic ratio, the intrinsic height of the image is its intrinsic width multiplied by the ratio.
	Otherwise, it has no intrinsic height.

<h2 class="heading settled heading" data-level=4 id=model><span class=secno>4 </span><span class=content>
Processing Model</span><a class=self-link href=#model></a></h2>

<p>	This section describes the processing model for images.

<p>	As each <code>&lt;img&gt;</code> element is encountered on the page,
	run the following steps for it:

	<ol>
		<li>
			Let <var>candidates</var> be the result of <a data-link-type=dfn href=#obtain-the-image-candidates title="obtaining the image candidates">obtaining the image candidates</a> from the element.

		<li>
			If <var>candidates</var> is empty,
			abort this algorithm.
			<p class=issue id=issue-1b127cd1><a class=self-link href=#issue-1b127cd1></a>
				Is this the right place to say "fire a load error" or whatever?

		<li>
			<p class=issue id=issue-0530be2c><a class=self-link href=#issue-0530be2c></a>
				Update the image data, choose the right candidate, etc, etc, hook up to the right terms in HTML.
				The actual choice is UA-specific.
	</ol>

<h3 class="heading settled heading" data-level=4.1 id=obtain-candidates><span class=secno>4.1 </span><span class=content>
Obtaining the Image Candidates</span><a class=self-link href=#obtain-candidates></a></h3>

<p>	This section describes how to <dfn data-dfn-type=dfn data-noexport="" id=obtain-the-image-candidates title="obtain the image candidates|obtaining the image candidates">obtain the image candidates<a class=self-link href=#obtain-the-image-candidates></a></dfn>
	from an HTML <code>&lt;img&gt;</code> element.

<p>	The input to this algorithm is an HTML <code>&lt;img&gt;</code> element.
	The output of this algorithm is a (possibly empty) list of <dfn data-dfn-type=dfn data-noexport="" id=image-candidate title="image candidate">image candidates<a class=self-link href=#image-candidate></a></dfn>,
	where each candidate is a pair composed of a url and a resolution.

	<ol>
		<li>
			Let <var>candidate attributes</var> be the list of attributes on the element who satisfy the following conditions:

<p>			<ul>
				<li>The attribute name is at least 5 characters long.

				<li>The first four characters of the attribute name are an <a data-link-spec=css-syntax data-link-type=dfn href=http://dev.w3.org/csswg/css-syntax-3/#ascii-case-insensitive title="ascii case-insensitive">ASCII case-insensitive</a> match for "src-".

				<li>The fifth character of the attribute name is a non-zero <a data-link-spec=css-syntax data-link-type=dfn href=http://dev.w3.org/csswg/css-syntax-3/#digit title=digit>digit</a> (1-9).

				<li>The remaining characters of the attribute name are <a data-link-spec=css-syntax data-link-type=dfn href=http://dev.w3.org/csswg/css-syntax-3/#digit title=digits>digits</a> (0-9).

				<li>The attribute value matches the <a class="production css-code" data-link-type=type href=#typedef-src-n-attribute title="<src-n-attribute>">&lt;src-n-attribute&gt;</a> production.
			</ul>

		<li>
			If <var>candidate attributes</var> is empty,
			return the result of <a data-link-type=dfn href=#obtain-a-candidate-from-src title="obtaining a candidate from src">obtaining a candidate from src</a> from the element
			and abort this algorithm.

		<li>
			For each <var>candidate attribute</var>,
			let its <var>index</var> be the result of removing the first four characters from the attribute name,
			and interpreting the remaining characters as a base-10 number.

		<li>
			Sort the <var>candidate attributes</var> by their <var>index</var> in ascending order.

		<li>
			For each <var>candidate attribute</var>:

			<ol>
				<li>
					If the attribute’s value contains a media query,
					evaluate that query.
					If it returns true,
					let <var>winning value</var> be the value of this attribute following the media query
					and abort this sub-algorithm.
					Otherwise, if it returns false,
					abort this sub-algorithm.

				<li>
					Otherwise, let <var>winning value</var> be this attribute’s value
					and abort this sub-algorithm.
			</ol>

		<li>
			If there is no <var>winning value</var>,
			return the result of <a data-link-type=dfn href=#obtain-a-candidate-from-src title="obtaining a candidate from src">obtaining a candidate from src</a> from the element
			and abort this algorithm.

		<li>
			Let <var>image candidates</var> be an initially empty list.

		<li>
			If the <var>winning value</var> conforms to the <a class="production css-code" data-link-type=type href=#typedef-x-based-urls title="<x-based-urls>">&lt;x-based-urls&gt;</a> production,
			then for each set of values between commas:

			<ol>
				<li>
					Let <var>candidate</var> be an <a data-link-type=dfn href=#image-candidate title="image candidate">image candidate</a> with its url being the <a class="production css-code" data-link-type=type href=http://dev.w3.org/csswg/css-values-3/#url-value title="<url>">&lt;url&gt;</a> from the current set of values.

				<li>
					If the current set of values contains a <a class="production css-code" data-link-type=type href=http://dev.w3.org/csswg/css-values-3/#resolution-value title="<resolution>">&lt;resolution&gt;</a>,
					let <var>candidate’s</var> resolution be that resolution.

				<li>
					Otherwise, let <var>candidate’s</var> resolution be <span class=css data-link-type=maybe title=1x>1x</span>.

				<li>
					Append <var>candidate</var> to <var>image candidates</var>.
			</ol>

<p>			Return <var>image candidates</var>,
			and abort this algorithm.

		<li>
			Otherwise,
			the <var>winning value</var> conforms to the <a class="production css-code" data-link-type=type href=#typedef-viewport-urls title="<viewport-urls>">&lt;viewport-urls&gt;</a> production.

		<li>
			Let <var>viewport data</var> be the portion of <var>winning value</var> that conforms to the <a class="production css-code" data-link-type=type href=#typedef-size-viewport-list title="<size-viewport-list>">&lt;size-viewport-list&gt;</a> production.
			Let <var>unprocessed candidates</var> be the portion of the <var>winning value</var> that conforms to the <a class="production css-code" data-link-type=type href=#typedef-size-based-urls title="<size-based-urls>">&lt;size-based-urls&gt;</a> production.

		<li>
			Divide <var>viewport data</var> into adjacent pairs of values,
			and a final lone value.

<p>			For each pair of values in <var>viewport data</var>:

			<ol>
				<li>
					Let <var>candidate viewport width</var> be the result of intepreting the second value as a <a class="production css-code" data-link-type=type href=http://dev.w3.org/csswg/css-values-3/#length-value title="<length>">&lt;length&gt;</a>,
					using the same rules as a <a class="production css-code" data-link-type=type href=http://dev.w3.org/csswg/css-values-3/#length-value title="<length>">&lt;length&gt;</a> in a <span class=css data-link-type=maybe title=min-width>min-width</span> media feature.

				<li>
					If the viewport’s width is less than <var>candidate viewport width</var>,
					then:

<p>					<ul>
						<li>
							If the first value is a <a class="production css-code" data-link-type=type href=http://dev.w3.org/csswg/css-values-3/#number-value title="<number>">&lt;number&gt;</a>,
							let <var>winning image width</var> be a length equal to that number of pixels.

						<li>
							Otherwise, the first value is a <a class="production css-code" data-link-type=type href=http://dev.w3.org/csswg/css-values-3/#percentage-value title="<percentage>">&lt;percentage&gt;</a>.
							Let <var>winning image width</var> be a length equal to the given percentage of the viewport’s width.
					</ul>

<p>					Abort this sub-algorithm.
			</ol>

		<li>
			For each set of values between commas of <var>unprocessed candidates</var>:

			<ol>
				<li>
					Let <var>candidate</var> be an <a data-link-type=dfn href=#image-candidate title="image candidate">image candidate</a> with its url being the <a class="production css-code" data-link-type=type href=http://dev.w3.org/csswg/css-values-3/#url-value title="<url>">&lt;url&gt;</a> from the current set of values.

				<li>
					Let <var>candidate’s</var> resolution be the result of dividing the <a class="production css-code" data-link-type=type href=http://dev.w3.org/csswg/css-syntax-3/#typedef-integer title="<integer>">&lt;integer&gt;</a> from the current set of values
					by the <var>winning image width</var>, as an <span class=css data-link-type=maybe title=x>x</span> unit.

				<li>
					Append <var>candidate</var> to <var>image candidates</var>.
			</ol>

<p>			Return <var>image candidates</var>.
	</ol>

<p>	To <dfn data-dfn-type=dfn data-noexport="" id=obtain-a-candidate-from-src title="obtain a candidate from src|obtaining a candidate from src">obtain a candidate from src<a class=self-link href=#obtain-a-candidate-from-src></a></dfn> from an element,
	follow these steps:

	<ol>
		<li>
			If the element has a <code>src</code> attribute,
			return a list consisting of a single <a data-link-type=dfn href=#image-candidate title="image candidate">image candidate</a>,
			where that candidate’s url is the value of the <code>src</code> attribute
			and its resolution is <span class=css data-link-type=maybe title=1x>1x</span>.

		<li>
			Otherwise,
			return an empty list.
	</ol>

	<p class=issue id=issue-0b8de5e0><a class=self-link href=#issue-0b8de5e0></a>
		In the event that this proposal "wins",
		but browsers have already shipped "basic" <code>srcset</code>
		(just support for resolution discrimination)
		and uptake is high enough that they can’t take it back,
		then we can easily integrate <code>srcset</code> into this fallback behavior.
		In other words, <code>srcset</code> doesn’t hurt this proposal
		(though it would be ideal if it didn’t exist alongside).

<h2 class="no-num no-ref heading settled heading" id=references><span class=content>
References</span><a class=self-link href=#references></a></h2>

<h3 class="no-num no-ref heading settled heading" id=normative><span class=content>
Normative References</span><a class=self-link href=#normative></a></h3>
<div data-fill-with=normative-references><dl><dt id=css3val title=CSS3VAL><a class=self-link href=#css3val></a>[CSS3VAL]<dd>Håkon Wium Lie; Tab Atkins; Elika J. Etemad. <a href=http://www.w3.org/TR/2013/CR-css3-values-20130730/>CSS Values and Units Module Level 3</a>. 30 July 2013. W3C Candidate Recommendation. (Work in progress.) URL: <a href=http://www.w3.org/TR/2013/CR-css3-values-20130730/>http://www.w3.org/TR/2013/CR-css3-values-20130730/</a></dl></div>

<h3 class="no-num no-ref heading settled heading" id=informative><span class=content>
Informative References</span><a class=self-link href=#informative></a></h3>
<div data-fill-with=informative-references><dl></dl></div>

<h2 class="no-num no-ref heading settled heading" id=index><span class=content>
Index</span><a class=self-link href=#index></a></h2>
<div data-fill-with=index><ul class=indexlist>
<li>art-direction, <a href=#art-direction title="section 2">2</a>
<li>image candidate, <a href=#image-candidate title="section 4.1">4.1</a>
<li>&lt;image-size&gt;, <a href=#typedef-image-size title="section 3">3</a>
<li>obtain a candidate from src, <a href=#obtain-a-candidate-from-src title="section 4.1">4.1</a>
<li>obtaining a candidate from src, <a href=#obtain-a-candidate-from-src title="section 4.1">4.1</a>
<li>obtaining the image candidates, <a href=#obtain-the-image-candidates title="section 4.1">4.1</a>
<li>obtain the image candidates, <a href=#obtain-the-image-candidates title="section 4.1">4.1</a>
<li>resolution, <a href=#resolution0 title="section 2">2</a>
<li>&lt;size-based-urls&gt;, <a href=#typedef-size-based-urls title="section 3">3</a>
<li>&lt;size-viewport-list&gt;, <a href=#typedef-size-viewport-list title="section 3">3</a>
<li>src-N, <a href=#src-n- title="section 3">3</a>
<li>src-N attribute, <a href=#src-n- title="section 3">3</a>
<li>&lt;src-n-attribute&gt;, <a href=#typedef-src-n-attribute title="section 3">3</a>
<li>viewport, <a href=#viewport title="section 2">2</a>
<li>&lt;viewport-size&gt;, <a href=#typedef-viewport-size title="section 3">3</a>
<li>&lt;viewport-urls&gt;, <a href=#typedef-viewport-urls title="section 3">3</a>
<li>&lt;x-based-urls&gt;, <a href=#typedef-x-based-urls title="section 3">3</a>
</ul></div>

<h2 class="no-num no-ref heading settled heading" id=property-index><span class=content>
Property index</span><a class=self-link href=#property-index></a></h2>
<div data-fill-with=property-index><p>No properties defined.</div>


<h2 class="no-num heading settled" id=issues-index><span class=content>Issues Index</span><a class=self-link href=#issues-index></a></h2><div style="counter-reset: issue"><div class=issue>
		I want just the second clause of the <code>media_query</code> grammar in Media Queries 4,
		where you have "(foo:bar) and (baz:qux)" and that’s it.
		I should go fix the grammar section there to expose this more cleanly.

<a href=#issue-c4f912a2> ↵ </a></div><div class=issue>
		Assume that I’ve already edited Images 4 appropriately so that <span class=css data-link-type=maybe title=x>x</span> is a valid resolution unit,
		equivalent to <span class=css data-link-type=maybe title=dppx>dppx</span>.

	<a href=#issue-507e8b4c> ↵ </a></div><div class=issue>
				Is this the right place to say "fire a load error" or whatever?

		<a href=#issue-1b127cd1> ↵ </a></div><div class=issue>
				Update the image data, choose the right candidate, etc, etc, hook up to the right terms in HTML.
				The actual choice is UA-specific.
	<a href=#issue-0530be2c> ↵ </a></div><div class=issue>
		In the event that this proposal "wins",
		but browsers have already shipped "basic" <code>srcset</code>
		(just support for resolution discrimination)
		and uptake is high enough that they can’t take it back,
		then we can easily integrate <code>srcset</code> into this fallback behavior.
		In other words, <code>srcset</code> doesn’t hurt this proposal
		(though it would be ideal if it didn’t exist alongside).

<a href=#issue-0b8de5e0> ↵ </a></div></div>